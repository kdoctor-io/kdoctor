# workflow for release

## pre-steps

* update 'version' and 'appVersion' filed in 'charts/*/Chart.yaml'

* update version in '/VERSION'

* a version tag should be set on right branch. The version should go with 

    * v0.1.0-rc0

    * v0.1.0-rc1

    * v0.1.0
  
    * v0.1.1
  
    * v0.1.2
  
    * v0.2.0-rc0
  
    * v0.2.0

## push a version tag

If a tag vx.x.x is pushed , the following steps will automatically run:

1. check the tag name is same with '/VERSION'

2. create a branch named 'release-vx.x.x'

3. build the images with the pushed tag, and push to ghcr registry

4. generate the changelog by historical PR labeled as "pr/release/*"

    submit the changelog file to directory 'changelogs' of branch 'github_pages', with PR labeled as "pr/release/robot_update_githubpage".

    changelogs is generated by historical PR label:

    label "release/feature-new" to be classified to "New Features"

    label "release/feature-changed" to be classified to "Changed Features"

    label "release/bug" to be classified to "Fixes"

5. build the chart package with the pushed tag, and submit a PR to branch 'github_pages' 

    you cloud get the chart with command `helm repo add $REPO_NAME https://kdoctor-io.github.io/$REPO_NAME `

6. submit '/docs' to '/docs' of branch 'github_pages'

7. create a GitHub Release attached with the chart package and changelog

8. Finally, by hand, need approve the chart PR labeled as "pr/release/robot_update_githubpage" , and changelog PR labeled as "pr/release/robot_update_githubpage"

## post

1. Submit a issue of the version update to the documentation site --> <https://github.com/DaoCloud/DaoCloud-docs>
