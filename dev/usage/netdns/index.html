
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../netreach/">
      
      
        <link rel="next" href="../debug/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.8">
    
    
      
        <title>NetDns - kdoctor</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#netdns" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="kdoctor" class="md-header__button md-logo" aria-label="kdoctor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            kdoctor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              NetDns
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/kdoctor-io/kdoctor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kdoctor-io/kdoctor
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  kdoctor

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../install/" class="md-tabs__link">
          
  
    
  
  Installation

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../apphttphealthy/" class="md-tabs__link">
          
  
    
  
  Usage

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/arch/" class="md-tabs__link">
          
  
    
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/apphttphealthy/" class="md-tabs__link">
          
  
    
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../develop/release/" class="md-tabs__link">
          
  
    
  
  Development

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="kdoctor" class="md-nav__button md-logo" aria-label="kdoctor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    kdoctor
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kdoctor-io/kdoctor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kdoctor-io/kdoctor
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kdoctor
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../get-started-kind/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickly Started
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../apphttphealthy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AppHttpHealthy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../netreach/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetReach
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    NetDns
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    NetDns
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    Steps
  </a>
  
    <nav class="md-nav" aria-label="Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-kdoctor" class="md-nav__link">
    Install kdoctor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-test-server-optional" class="md-nav__link">
    Install Test Server (Optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-netdns" class="md-nav__link">
    Create NetDns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-task-status" class="md-nav__link">
    Check Task Status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-task-reports" class="md-nav__link">
    View Task Reports
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-an-external-dns-server" class="md-nav__link">
    Test an External DNS Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-cleanup" class="md-nav__link">
    Environment Cleanup
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/arch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/runtime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Runtime
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/apphttphealthy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AppHttpHealthy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/netreach/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetReach
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/netdns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetDns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kdoctor-controller/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kdoctor-controller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kdoctor-agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kdoctor-agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/report/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Report
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/release/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribution
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    Steps
  </a>
  
    <nav class="md-nav" aria-label="Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-kdoctor" class="md-nav__link">
    Install kdoctor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-test-server-optional" class="md-nav__link">
    Install Test Server (Optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-netdns" class="md-nav__link">
    Create NetDns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-task-status" class="md-nav__link">
    Check Task Status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-task-reports" class="md-nav__link">
    View Task Reports
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-an-external-dns-server" class="md-nav__link">
    Test an External DNS Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-cleanup" class="md-nav__link">
    Environment Cleanup
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="netdns">netdns</h1>
<p><a href="../netdns-zh_CN/"><strong>简体中文</strong></a> | <strong>English</strong></p>
<h2 id="introduction">Introduction</h2>
<p>kdoctor-controller creates the necessary resources, including <a href="../../concepts/runtime/">agent</a>, based on the agentSpec. Each agent Pod sends DNS requests to a specified DNS server. By default, the concurrency level is set to 50, which can handle scenarios with multiple replicas. The concurrency level can be configured in the kdoctor configmap. The success rate and average latency are measured, and the results are evaluated based on predefined success criteria. Detailed reports can be obtained using the aggregate API.</p>
<ol>
<li>
<p>Use Cases:</p>
<ul>
<li>Test the accessibility of the CoreDNS service from all corners of the cluster in production or E2E environments.</li>
<li>Adjust CoreDNS resources and replica count during application deployment to ensure it can handle the expected load.</li>
<li>Apply stress to CoreDNS for purposes like testing upgrades, chaos tests, bug reproduction, etc</li>
<li>Test external DNS services from within the cluster.</li>
</ul>
</li>
<li>
<p>For more detailed information about the NetDns CRD, refer to <a href="../../reference/netdns/">NetDns</a></p>
</li>
<li>
<p>Features:</p>
<ul>
<li>Support testing DNS servers both inside and outside the cluster</li>
<li>Supports typeA and typeAAAA records</li>
<li>Supports UDP, TCP, and TCP-TLS protocols</li>
</ul>
</li>
</ol>
<h2 id="steps">Steps</h2>
<p>The following example demonstrates how to use <code>NetDNS</code>.</p>
<h3 id="install-kdoctor">Install kdoctor</h3>
<p>Follow the <a href="../install/">installation guide</a> to install kdoctor.</p>
<h3 id="install-test-server-optional">Install Test Server (Optional)</h3>
<p>The official kdoctor repository includes an application called "server" that contains an HTTP server, HTTPS server, and DNS server. This server can be employed to test the functionality of kdoctor. If you have other test servers available, you can skip this installation step.</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>kdoctor<span class="w"> </span>https://kdoctor-io.github.io/kdoctor
helm<span class="w"> </span>repo<span class="w"> </span>update<span class="w"> </span>kdoctor
helm<span class="w"> </span>install<span class="w"> </span>server<span class="w"> </span>kdoctor/server<span class="w"> </span>-n<span class="w"> </span>kdoctor-test-server<span class="w"> </span>--wait<span class="w"> </span>--debug<span class="w"> </span>--create-namespace<span class="w"> </span>
</code></pre></div>
<p>Check the status of test server</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>kdoctor<span class="w"> </span>-owide
NAME<span class="w">                                </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE<span class="w">   </span>IP<span class="w">            </span>NODE<span class="w">                    </span>NOMINATED<span class="w"> </span>NODE<span class="w">   </span>READINESS<span class="w"> </span>GATES
server-7649566ff9-dv4jc<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>76s<span class="w">   </span><span class="m">172</span>.40.1.45<span class="w">   </span>kdoctor-worker<span class="w">          </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
server-7649566ff9-qc5dh<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>76s<span class="w">   </span><span class="m">172</span>.40.0.35<span class="w">   </span>kdoctor-control-plane<span class="w">   </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
</code></pre></div>
<p>Obtain the service address of the test server</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>service<span class="w"> </span>-n<span class="w"> </span>kdoctor<span class="w"> </span>
NAME<span class="w">               </span>TYPE<span class="w">        </span>CLUSTER-IP<span class="w">    </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">                                </span>AGE
server<span class="w">   </span>ClusterIP<span class="w">   </span><span class="m">172</span>.41.71.0<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">80</span>/TCP,443/TCP,53/UDP,53/TCP,853/TCP<span class="w">   </span>2m31s
</code></pre></div>
<h3 id="create-netdns">Create NetDns</h3>
<p>Create <code>NetDns</code> object that will execute a 10-second continuous task. The task will send UDP requests to the cluster's internal DNS server at a rate of 10 QPS. It will request the typeA records whose domain name is <code>kubernetes.default.svc.cluster.local</code>.</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: kdoctor.io/v1beta1</span>
<span class="s">kind: Netdns</span>
<span class="s">metadata:</span>
<span class="s">  name: netdns-cluster</span>
<span class="s">spec:</span>
<span class="s">  expect:</span>
<span class="s">    meanAccessDelayInMs: 1500</span>
<span class="s">    successRate: 1</span>
<span class="s">  request:</span>
<span class="s">    domain: kubernetes.default.svc.cluster.local</span>
<span class="s">    durationInSecond: 10</span>
<span class="s">    perRequestTimeoutInMS: 1000</span>
<span class="s">    protocol: udp</span>
<span class="s">    qps: 10</span>
<span class="s">  schedule:</span>
<span class="s">    roundNumber: 1</span>
<span class="s">    roundTimeoutMinute: 1</span>
<span class="s">    schedule: 0 1</span>
<span class="s">  target:</span>
<span class="s">    targetDns:</span>
<span class="s">      serviceName: kube-dns</span>
<span class="s">      serviceNamespace: kube-system</span>
<span class="s">      testIPv4: true</span>
<span class="s">EOF</span>
</code></pre></div>
<h3 id="check-task-status">Check Task Status</h3>
<p>After completing a round of tasks, you can use the kdoctor aggregate API to view the report for the current round. When the FINISH field is set to true, it indicates that all tasks have been completed, and you can access the overall report.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>netdns
NAME<span class="w">             </span>FINISH<span class="w">   </span>EXPECTEDROUND<span class="w">   </span>DONEROUND<span class="w">   </span>LASTROUNDSTATUS<span class="w">   </span>SCHEDULE
netdns-cluster<span class="w">   </span><span class="nb">true</span><span class="w">     </span><span class="m">1</span><span class="w">               </span><span class="m">1</span><span class="w">           </span>succeed<span class="w">           </span><span class="m">0</span><span class="w"> </span><span class="m">1</span>
</code></pre></div>
<ul>
<li>FINISH: indicate whether the task has been completed</li>
<li>EXPECTEDROUND: number of expected task rounds</li>
<li>DONEROUND: number of completed task rounds</li>
<li>LASTROUNDSTATUS: execution status of the last round of tasks</li>
<li>SCHEDULE: schedule rules for the task</li>
</ul>
<h3 id="view-task-reports">View Task Reports</h3>
<ol>
<li>
<p>View existed reports</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>kdoctorreport
NAME<span class="w">             </span>CREATED<span class="w"> </span>AT
netdns-cluster<span class="w">   </span><span class="m">0001</span>-01-01T00:00:00Z
</code></pre></div>
</li>
<li>
<p>View specific task reports</p>
<p>The reports are aggregated from the agents running on both the kdoctor-control-plane node and the kdoctor-worker nodes after performing two rounds of stress testing respectively.</p>
<div class="highlight"><pre><span></span><code>root@kdoctor-control-plane:/#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>kdoctorreport<span class="w"> </span>netdns-cluster<span class="w"> </span>-oyaml
apiVersion:<span class="w"> </span>system.kdoctor.io/v1beta1
kind:<span class="w"> </span>KdoctorReport
metadata:
<span class="w">  </span>creationTimestamp:<span class="w"> </span>null
<span class="w">  </span>name:<span class="w"> </span>netdns-cluster
spec:
<span class="w">  </span>FailedRoundNumber:<span class="w"> </span>null
<span class="w">  </span>FinishedRoundNumber:<span class="w"> </span><span class="m">1</span>
<span class="w">  </span>Report:
<span class="w">  </span>-<span class="w"> </span>NodeName:<span class="w"> </span>kdoctor-control-plane
<span class="w">    </span>PodName:<span class="w"> </span>kdoctor-agent-ntp9l
<span class="w">    </span>ReportType:<span class="w"> </span>agent<span class="w"> </span><span class="nb">test</span><span class="w"> </span>report
<span class="w">    </span>RoundDuration:<span class="w"> </span><span class="m">11</span>.025723086s
<span class="w">    </span>RoundNumber:<span class="w"> </span><span class="m">1</span>
<span class="w">    </span>RoundResult:<span class="w"> </span>succeed
<span class="w">    </span>StartTimeStamp:<span class="w"> </span><span class="s2">&quot;2023-08-01T09:09:39Z&quot;</span>
<span class="w">    </span>EndTimeStamp:<span class="w"> </span><span class="s2">&quot;2023-08-01T09:09:50Z&quot;</span>
<span class="w">    </span>TaskName:<span class="w"> </span>netdns.netdns-cluster
<span class="w">    </span>TaskType:<span class="w"> </span>Netdns
<span class="w">    </span>netDNSTask:
<span class="w">      </span>detail:
<span class="w">      </span>-<span class="w"> </span>FailureReason:<span class="w"> </span>null
<span class="w">        </span>MeanDelay:<span class="w"> </span><span class="m">0</span>.2970297
<span class="w">        </span>Metrics:
<span class="w">          </span>DNSMethod:<span class="w"> </span>udp
<span class="w">          </span>DNSServer:<span class="w"> </span><span class="m">172</span>.41.0.10:53
<span class="w">          </span>Duration:<span class="w"> </span><span class="m">11</span>.002666395s
<span class="w">          </span>EndTime:<span class="w"> </span><span class="s2">&quot;2023-08-01T09:09:50Z&quot;</span>
<span class="w">          </span>Errors:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>FailedCounts:<span class="w"> </span><span class="m">0</span>
<span class="w">          </span>Latencies:
<span class="w">            </span>MaxInMs:<span class="w"> </span><span class="m">0</span>
<span class="w">            </span>MeanInMs:<span class="w"> </span><span class="m">0</span>.2970297
<span class="w">            </span>MinInMs:<span class="w"> </span><span class="m">0</span>
<span class="w">            </span>P50InMs:<span class="w"> </span><span class="m">0</span>
<span class="w">            </span>P90InMs:<span class="w"> </span><span class="m">0</span>
<span class="w">            </span>P95InMs:<span class="w"> </span><span class="m">0</span>
<span class="w">            </span>P99InMs:<span class="w"> </span><span class="m">0</span>
<span class="w">          </span>ReplyCode:
<span class="w">            </span>NOERROR:<span class="w"> </span><span class="m">101</span>
<span class="w">          </span>RequestCounts:<span class="w"> </span><span class="m">101</span>
<span class="w">          </span>StartTime:<span class="w"> </span><span class="s2">&quot;2023-08-01T09:09:39Z&quot;</span>
<span class="w">          </span>SuccessCounts:<span class="w"> </span><span class="m">101</span>
<span class="w">          </span>TPS:<span class="w"> </span><span class="m">9</span>.179593052634765
<span class="w">          </span>TargetDomain:<span class="w"> </span>kubernetes.default.svc.cluster.local.
<span class="w">        </span>Succeed:<span class="w"> </span><span class="nb">true</span>
<span class="w">        </span>SucceedRate:<span class="w"> </span><span class="m">1</span>
<span class="w">        </span>TargetName:<span class="w"> </span>typeA_172.41.0.10:53_kubernetes.default.svc.cluster.local
<span class="w">        </span>TargetProtocol:<span class="w"> </span>udp
<span class="w">        </span>TargetServer:<span class="w"> </span><span class="m">172</span>.41.0.10:53
<span class="w">      </span>succeed:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>targetNumber:<span class="w"> </span><span class="m">1</span>
<span class="w">      </span>targetType:<span class="w"> </span>kdoctor<span class="w"> </span>agent
<span class="w">      </span>MaxCPU:<span class="w"> </span><span class="m">30</span>.651%
<span class="w">      </span>MaxMemory:<span class="w"> </span><span class="m">97</span>.00MB
<span class="w">    </span>netDNSTaskSpec:
<span class="w">      </span>...
<span class="w">  </span>-<span class="w"> </span>NodeName:<span class="w"> </span>kdoctor-worker
<span class="w">    </span>PodName:<span class="w"> </span>kdoctor-agent-krrnp
<span class="w">    </span>ReportType:<span class="w"> </span>agent<span class="w"> </span><span class="nb">test</span><span class="w"> </span>report
<span class="w">    </span>RoundDuration:<span class="w"> </span><span class="m">10</span>.024533428s
<span class="w">    </span>RoundNumber:<span class="w"> </span><span class="m">1</span>
<span class="w">    </span>RoundResult:<span class="w"> </span>succeed
<span class="w">    </span>StartTimeStamp:<span class="w"> </span><span class="s2">&quot;2023-08-01T09:09:39Z&quot;</span>
<span class="w">    </span>EndTimeStamp:<span class="w"> </span><span class="s2">&quot;2023-08-01T09:09:49Z&quot;</span>
<span class="w">    </span>TaskName:<span class="w"> </span>netdns.netdns-cluster
<span class="w">    </span>TaskType:<span class="w"> </span>Netdns
<span class="w">    </span>netDNSTask:
<span class="w">      </span>detail:
<span class="w">      </span>-<span class="w"> </span>FailureReason:<span class="w"> </span>null
<span class="w">        </span>MeanDelay:<span class="w"> </span><span class="m">0</span>.58
<span class="w">        </span>Metrics:
<span class="w">          </span>...
<span class="w">        </span>Succeed:<span class="w"> </span><span class="nb">true</span>
<span class="w">        </span>SucceedRate:<span class="w"> </span><span class="m">1</span>
<span class="w">        </span>TargetName:<span class="w"> </span>typeA_172.41.0.10:53_kubernetes.default.svc.cluster.local
<span class="w">        </span>TargetProtocol:<span class="w"> </span>udp
<span class="w">        </span>TargetServer:<span class="w"> </span><span class="m">172</span>.41.0.10:53
<span class="w">      </span>succeed:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>targetNumber:<span class="w"> </span><span class="m">1</span>
<span class="w">      </span>targetType:<span class="w"> </span>kdoctor<span class="w"> </span>agent
<span class="w">      </span>MaxCPU:<span class="w"> </span><span class="m">30</span>.651%
<span class="w">      </span>MaxMemory:<span class="w"> </span><span class="m">97</span>.00MB
<span class="w">    </span>netDNSTaskSpec:
<span class="w">      </span>...
<span class="w">  </span>ReportRoundNumber:<span class="w"> </span><span class="m">1</span>
<span class="w">  </span>RoundNumber:<span class="w"> </span><span class="m">1</span>
<span class="w">  </span>Status:<span class="w"> </span>Finished
<span class="w">  </span>TaskName:<span class="w"> </span>netdns-cluster
<span class="w">  </span>TaskType:<span class="w"> </span>Netdns
</code></pre></div>
</li>
</ol>
<blockquote>
<p>If the reports do not align with the expected results, check the MaxCPU and MaxMemory fields in the report to verify if there are available resources of the agents and adjust the resource limits for the agents accordingly.</p>
</blockquote>
<h2 id="test-an-external-dns-server">Test an External DNS Server</h2>
<p>Below are examples of HTTP and HTTPS requests with body:</p>
<ol>
<li>
<p>Create <code>NetDns</code> object that will execute a 10-second continuous task. The task will send UDP requests to the cluster's internal DNS server at a rate of 10 QPS. It will request the typeA records whose domain name is <code>kubernetes.default.svc.cluster.local</code>.</p>
<p>We are using the service address of the test server. If you have a different server address available, feel free to use it instead.</p>
<p>Create <code>NetDns</code></p>
<div class="highlight"><pre><span></span><code><span class="nv">SERVER</span><span class="o">=</span><span class="s2">&quot;172.41.71.0&quot;</span>
apiVersion:<span class="w"> </span>kdoctor.io/v1beta1
kind:<span class="w"> </span>Netdns
metadata:
<span class="w">  </span>name:<span class="w"> </span>netdns-<span class="w"> </span>user
spec:
<span class="w">  </span>expect:
<span class="w">    </span>meanAccessDelayInMs:<span class="w"> </span><span class="m">1500</span>
<span class="w">    </span>successRate:<span class="w"> </span><span class="m">1</span>
<span class="w">  </span>request:
<span class="w">    </span>domain:<span class="w"> </span>kubernetes.default.svc.cluster.local
<span class="w">    </span>durationInSecond:<span class="w"> </span><span class="m">10</span>
<span class="w">    </span>perRequestTimeoutInMS:<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>protocol:<span class="w"> </span>udp
<span class="w">    </span>qps:<span class="w"> </span><span class="m">10</span>
<span class="w">  </span>schedule:
<span class="w">    </span>roundNumber:<span class="w"> </span><span class="m">1</span>
<span class="w">    </span>roundTimeoutMinute:<span class="w"> </span><span class="m">1</span>
<span class="w">    </span>schedule:<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span>target:
<span class="w">    </span>targetUser:
<span class="w">      </span>port:<span class="w"> </span><span class="m">53</span>
<span class="w">      </span>server:<span class="w"> </span><span class="si">${</span><span class="nv">SERVER</span><span class="si">}</span>
EOF
</code></pre></div>
</li>
</ol>
<h2 id="environment-cleanup">Environment Cleanup</h2>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>netdns<span class="w"> </span>netdns-cluster<span class="w"> </span>netdns-<span class="w"> </span>user
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "search.share"], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  </body>
</html>